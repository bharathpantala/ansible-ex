---
- hosts: mysql
  become: true
  vars:
          MYSQL_ROOT_PASSWD: sharath10
          MYSQL_USERNAME: jda
          update_pack_manager: yes
          #          MYSQL_PASSWD: "{E:AES}18ae14adb41924bee357e4d74e7facae"
          MYSQL_PASSWD: jda

  tasks:
    - name: Download MySQL Community Repo
      get_url: url=http://repo.mysql.com/mysql-community-release-el7-7.noarch.rpm dest=/tmp/mysql-community-release-el7-7.noarch.rpm

    - name: Install MySQL Community Repo
      command: /bin/rpm -ivh /tmp/mysql-community-release-el7-7.noarch.rpm
      register: mysql_repo_result
      failed_when: "'conflict' in mysql_repo_result.stderr"
      args:
        warn: no

    - name: Install MySQL Server
      yum: name={{item}} state=present update_cache={{ update_pack_manager }}
      with_items:
      - mysql
      - mysql-server

    - name: Install MySQL-python, this is required for the task remove anonymous user
      yum: name=MySQL-python state=present

    - name: Start MySQL Server and enable it
      service: name=mysqld state=started enabled=yes

    - name: Remove Test database if it exist.
      mysql_db: name=test state=absent

    - name: Remove all anonymous user accounts
      mysql_user:
        name: ''
        host_all: yes
        state: absent

    - name: Output ansible_hostname
      debug: msg=Hostname is {{ ansible_hostname }}

    - name: Change root password
      mysql_user: name=root host={{ item }} password={{ MYSQL_ROOT_PASSWD }}
      with_items:
       - “{{ ansible_hostname }}”
       - 127.0.0.1
       – ::1
       – localhost

    - name: Create a database
      mysql_db:
        name:
          - JDA_ANU
          - BHARATH_ANU
        state: present

    - name: Create a User for App
      mysql_user:
        name: "{{ MYSQL_USERNAME }}"
        password: "{{ MYSQL_PASSWD }}"
        priv: '*.*:ALL'
        state: present
